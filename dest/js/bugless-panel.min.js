function CMD(e,t){this.element=e,this.threshold=t.threshold||20,this.preventScroll=t.preventScroll||!1,this.innerElement=t.innerElement,this.exceptions=t.exceptions||[],this.startX=null,this.startY=null,this._startTarget=null,this.initListeners()}function Panel(e,t){var n=this;if(n.element=document.querySelector(e),n.innerElement=n.element.querySelector(".inner"),!n.element)throw new Error('Panel "'+e+'" not found');if(!n.innerElement)throw new Error("Panel inner not found");if(!t.position)throw new Error("Please specify the panel position");switch(n.x=null,n.y=null,n.isOpened=!1,n.isMoving=!1,n.position=t.position,n.width=n.w=t.width||100,n.height=t.height||100,n.maxWidth=t.maxWidth||null,n.exceptions=t.exceptions||[],n.closeBySwipe=t.closeBySwipe||!0,n.elementCMD=new CMD(n.element,{threshold:BuglessPanels.moveThreshold,preventScroll:!0,innerElement:n.innerElement,exceptions:n.exceptions}),n.position){case Panel.POSITION_LEFT:n.x=-100,n.y=0,Help.addClass(n.element,"left"),n.closeBySwipe&&n.listenLeftSwipe();break;case Panel.POSITION_RIGHT:n.x=100,n.y=0,Help.addClass(n.element,"right"),n.closeBySwipe&&n.listenRightSwipe();break;case Panel.POSITION_TOP:n.x=0,n.y=-100,Help.addClass(n.element,"top"),n.closeBySwipe&&n.listenTopSwipe();break;case Panel.POSITION_BOTTOM:n.x=0,n.y=100,Help.addClass(n.element,"bottom"),n.closeBySwipe&&n.listenBottomSwipe()}if(BuglessPanels.panels.push(n),n.applyPanelSizes(),n.innerElement.querySelectorAll('input[type="text"], select').length){var i=n.innerElement.querySelectorAll('input[type="text"], select'),l=document.createElement("div");l.className="iosfix";for(var a=0;a<i.length;a++)i[a].addEventListener("focusout",function(){n.innerElement.appendChild(l),setTimeout(function(){n.innerElement.querySelector(".iosfix").remove()},500)})}window.addEventListener("resize",function(){setTimeout(function(){n.applyPanelSizes()},100)},!1)}CMD.prototype.isException=function(e){var t=this,n=t.exceptions.length;if(0===n)return!1;for(var i=0;n>i;i++)if(Help.closest(e,t.exceptions[i])||e==document.querySelector(t.exceptions[i]))return!0;return!1},CMD.prototype.initListeners=function(){var e=this,t=!1,n=!1,i={direction:null,touches:null,deltaX:null,deltaY:null};e.element.addEventListener("touchstart",function(t){e._startTarget=t.target,e.startX=t.touches[0].clientX,e.startY=t.touches[0].clientY,e.isException(e._startTarget)},!1),e.element.addEventListener("touchmove",function(l){var a=l.touches[0].clientX-e.startX,o=l.touches[0].clientY-e.startY,s=Math.abs(a)>0,c=Math.abs(o)>0,r=Math.abs(o)>Math.abs(a);e.preventScroll&&(o>0&&r&&e.element.scrollTop<=0&&l.preventDefault(),e.innerElement&&0>o&&r&&e.element.scrollTop+e.element.offsetHeight>=e.innerElement.offsetHeight&&l.preventDefault()),e.isException(e._startTarget)||(i={touches:l.touches,deltaX:a,deltaY:o,direction:t},t===!1?(Math.abs(a)>e.threshold&&(t=a>0?"right":"left",n="horizontal"),Math.abs(o)>e.threshold&&(t=o>0?"bottom":"top",n="vertical"),s&&(a>0?e.triggerEvent("moveright",i):0>a&&e.triggerEvent("moveleft",i)),c&&(o>0?e.triggerEvent("movebottom",i):0>o&&e.triggerEvent("movetop",i))):("right"!=t&&"left"!=t||!c||l.preventDefault(),e.triggerEvent("move"+t,i)))},!1),e.element.addEventListener("touchend",function(){e.isException(e._startTarget)||(e.triggerEvent("moveend"+t,i),t=!1)},!1),e.element.addEventListener("touchcancel",function(){e.isException(e._startTarget)||(e.triggerEvent("moveend"+t,i),t=!1)},!1)},CMD.prototype.triggerEvent=function(e,t){Help.triggerEvent(this.element,e,t)},CMD.prototype.on=function(e,t){Help.addListener(this.element,e,t,!1)},CMD.prototype.off=function(e){Help.removeListener(this.element,e)};var BuglessPanels={moveThreshold:20,panelThreshold:40,panels:[],activePanel:null,exceptions:[],_startTarget:null,init:function(e){if(this.params=e,!e.content)throw new Error('"content" parameter was not passed');if(this.content=e.content,this.contentElement=document.querySelector(e.content),!this.contentElement)throw new Error("Content element not found");if(this.moveThreshold=this.params.moveThreshold||20,this.panelThreshold=this.params.panelThreshold||40,this.exceptions=this.params.exceptions||[],e.leftPanel){if(!(e.leftPanel instanceof Panel))throw new Error('"leftPanel" parameter must be an instance of Panel');this.leftPanel=e.leftPanel,this.leftPanel.position=Panel.POSITION_LEFT,this.initContentCMD(),this.listenRightSwipe()}if(e.rightPanel){if(!(e.rightPanel instanceof Panel))throw new Error('"leftPanel" parameter must be an instance of Panel');this.rightPanel=e.rightPanel,this.rightPanel.position=Panel.POSITION_RIGHT,this.initContentCMD(),this.listenLeftSwipe()}this.initBackdrop()},initBackdrop:function(){var e=this;if(this.backdrop=document.querySelector(".bugless-backdrop"),null==this.backdrop){this.backdrop=document.createElement("div"),this.backdrop.setAttribute("class","bugless-backdrop"),this.backdrop.style.display="none",document.body.appendChild(this.backdrop);var t=null,n=null;this.backdrop.addEventListener("touchstart",function(i){t=i.touches[0].clientX,n=i.touches[0].clientY,e.activePanel&&e.activePanel.animateOff()}),this.backdrop.addEventListener("touchmove",function(t){if(e.activePanel){if(e.activePanel.position==Panel.POSITION_LEFT||e.activePanel.position==Panel.POSITION_RIGHT){n!=t.touches[0].clientY&&t.preventDefault();var i=Help.calculatePercentageX(t.touches[0].clientX),l=100*i/e.activePanel.width}if(e.activePanel.position==Panel.POSITION_TOP||e.activePanel.position==Panel.POSITION_BOTTOM){t.preventDefault();var a=Help.calculatePercentageY(t.touches[0].clientY),o=100*a/e.activePanel.height}e.activePanel.position==Panel.POSITION_TOP&&a<=e.activePanel.height&&e.activePanel.moveY(o),e.activePanel.position==Panel.POSITION_BOTTOM&&a>=100-e.activePanel.height&&e.activePanel.moveY(o-100*(100-e.activePanel.height)/e.activePanel.height),e.activePanel.position==Panel.POSITION_LEFT&&i<=e.activePanel.width&&e.activePanel.moveX(l),e.activePanel.position==Panel.POSITION_RIGHT&&i>=100-e.activePanel.width&&e.activePanel.moveX(l-100*(100-e.activePanel.width)/e.activePanel.width)}},!1),this.backdrop.addEventListener("touchend",function(i){return t<i.changedTouches[0].clientX+5&&t>i.changedTouches[0].clientX-5&&n<i.changedTouches[0].clientY+5&&n>i.changedTouches[0].clientY-5?e.closeAll():void(e.activePanel&&(e.activePanel&&e.activePanel.position==Panel.POSITION_TOP&&(100-e.activePanel.y<e.panelThreshold?e.activePanel.open():e.activePanel.close()),e.activePanel&&e.activePanel.position==Panel.POSITION_BOTTOM&&(e.activePanel.y<e.panelThreshold?e.activePanel.open():e.activePanel.close()),e.activePanel&&e.activePanel.position==Panel.POSITION_LEFT&&(100-e.activePanel.x<e.panelThreshold?e.activePanel.open():e.activePanel.close()),e.activePanel&&e.activePanel.position==Panel.POSITION_RIGHT&&(e.activePanel.x<e.panelThreshold?e.activePanel.open():e.activePanel.close())))})}},initContentCMD:function(){var e=this;this.contentCMD||(this.contentCMD=new CMD(this.contentElement,{threshold:e.moveThreshold,exceptions:e.exceptions}),this.contentCMD.on("touchstart",function(){e.panelsAnimateOff()}))},listenRightSwipe:function(){var e=this,t=null,n=!1;e.contentCMD.on("touchstart",function(e){t=Help.calculatePercentageX(e.touches[0].clientX),n=null==Help.closest(e.target,".bugless-panel")&&e.target!=document.querySelector(".bugless-panel")}),e.contentCMD.on("moveright",function(i){if(i.direction!==!1&&n){e.leftPanel.onShow&&!e.leftPanel.onShowWasCalled&&(e.leftPanel.onShow(e.leftPanel),e.leftPanel.onShowWasCalled=!0),e.leftPanel.show();var l=Help.calculatePercentageX(i.touches[0].clientX);null!==e.leftPanel.maxWidth&&t>e.leftPanel.width&&(l-=t);var a=100*l/e.leftPanel.width;e.leftPanel.moveX(a)}}),e.contentCMD.on("moveendright",function(){var t=100*e.leftPanel.x/e.leftPanel.width;t>e.panelThreshold?e.leftPanel.open():e.leftPanel.close(),e.leftPanel.onShowWasCalled=!1,n=!1})},listenLeftSwipe:function(){var e=this,t=null,n=!1;e.contentCMD.on("touchstart",function(e){t=Help.calculatePercentageX(Help.screenWidth()-e.touches[0].clientX),n=null==Help.closest(e.target,".bugless-panel")&&e.target!=document.querySelector(".bugless-panel")}),e.contentCMD.on("moveleft",function(i){if(i.direction!==!1&&n){e.rightPanel.onShow&&!e.rightPanel.onShowWasCalled&&(e.rightPanel.onShow(e.rightPanel),e.rightPanel.onShowWasCalled=!0),e.rightPanel.show();var l=Help.calculatePercentageX(i.touches[0].clientX);null!==e.rightPanel.maxWidth&&t>e.rightPanel.width&&(l+=t);var a=100*l/e.rightPanel.width;e.rightPanel.moveX(a-100*(100-e.rightPanel.width)/e.rightPanel.width)}}),e.contentCMD.on("moveendleft",function(){e.rightPanel.x<100-e.panelThreshold?e.rightPanel.open():e.rightPanel.close(),e.rightPanel.onShowWasCalled=!1,n=!1})},getAnimationTime:function(e){var t=0;try{t=1e3*parseFloat(getComputedStyle(document.querySelector(e)).transitionDuration)}catch(n){t=200}return t},panelsAnimateOff:function(){for(var e in this.panels)this.panels[e].animateOff()},closeAll:function(){for(var e in this.panels)this.panels[e].isOpened&&this.panels[e].close()},backdropOn:function(){var e=this;e.backdrop.style.display="block";var t=setInterval(function(){"block"==e.backdrop.style.display&&(Help.addClass(e.backdrop,"in"),clearInterval(t))})},backdropOff:function(){var e=this;Help.removeClass(e.backdrop,"in"),setTimeout(function(){e.backdrop.style.display="none"},e.getAnimationTime(".bugless-backdrop"))}};Panel.POSITION_LEFT=1,Panel.POSITION_RIGHT=2,Panel.POSITION_TOP=4,Panel.POSITION_BOTTOM=6,Panel.prototype.applyPanelSizes=function(){var e=this;null!==e.maxWidth&&(e.width=Help.screenWidth()*e.w/100>e.maxWidth?100*e.maxWidth/Help.screenWidth():e.w),e.element.style.width=e.width+"%",e.element.style.height=e.height+"%"},Panel.prototype.listenTopSwipe=function(){var e=this,t=null;e.elementCMD.on("touchstart",function(n){e.animateOff(),t=e.height-Help.calculatePercentageY(n.touches[0].clientY)}),e.elementCMD.on("movetop",function(n){if(n.direction!==!1&&e.element.scrollTop+e.element.offsetHeight>=e.innerElement.offsetHeight){var i=Help.calculatePercentageY(n.touches[0].clientY),l=100*i/e.height;e.moveY(l+t)}}),e.elementCMD.on("moveendtop",function(){e.y<100-BuglessPanels.panelThreshold?e.close():e.open()})},Panel.prototype.listenBottomSwipe=function(){var e=this,t=null;e.elementCMD.on("touchstart",function(n){e.animateOff(),t=e.height-Help.calculatePercentageY(Help.screenHeight()-n.touches[0].clientY)}),e.elementCMD.on("movebottom",function(n){if(n.direction!==!1&&e.element.scrollTop<=0){var i=100*Help.calculatePercentageY(n.touches[0].clientY)/e.height;i-=100*(100-e.height)/e.height,e.moveY(i-t)}}),e.elementCMD.on("moveendbottom",function(){e.y>BuglessPanels.panelThreshold?e.close():e.open()})},Panel.prototype.listenLeftSwipe=function(){var e=this,t=null;e.elementCMD.on("touchstart",function(n){e.animateOff(),t=e.width-Help.calculatePercentageX(n.touches[0].clientX)}),e.elementCMD.on("moveleft",function(n){if(n.direction!==!1){var i=Help.calculatePercentageX(n.touches[0].clientX),l=100*i/e.width;e.moveX(l+t)}}),e.elementCMD.on("moveendleft",function(){e.x<100-BuglessPanels.panelThreshold?e.close():e.open()})},Panel.prototype.listenRightSwipe=function(){var e=this,t=null;e.elementCMD.on("touchstart",function(n){e.animateOff(),t=e.width-Help.calculatePercentageX(Help.screenWidth()-n.touches[0].clientX)}),e.elementCMD.on("moveright",function(n){if(n.direction!==!1){var i=100*Help.calculatePercentageX(n.touches[0].clientX)/e.width;i-=100*(100-e.width)/e.width,e.moveX(i-t)}}),e.elementCMD.on("moveendright",function(){e.x>BuglessPanels.panelThreshold?e.close():e.open()})},Panel.prototype.animateOff=function(){Help.removeClass(this.element,"animate")},Panel.prototype.animateOn=function(){Help.addClass(this.element,"animate")},Panel.prototype.show=function(){this.shown||(BuglessPanels.backdropOn(),this.element.style.display="block",this.shown=!0)},Panel.prototype.hide=function(){this.element.style.display="none"},Panel.prototype.moveX=function(e){return this.position==Panel.POSITION_LEFT&&e>100?!1:this.position==Panel.POSITION_RIGHT&&0>e?!1:(this.x=e,e=this.position==Panel.POSITION_LEFT?-100+e:e,this.element.style.transform="translateX("+e+"%)",void(this.isMoving||(Help.triggerEvent(this.element,this.isOpened?"close":"open",{panel:this}),this.isMoving=!0)))},Panel.prototype.moveY=function(e){return this.position==Panel.POSITION_TOP&&e>100?!1:this.position==Panel.POSITION_BOTTOM&&0>e?!1:(this.y=e,e=this.position==Panel.POSITION_TOP?-100+e:e,this.element.style.transform="translateY("+e+"%)",void(this.isMoving||(Help.triggerEvent(this.element,this.isOpened?"close":"open",{panel:this}),this.isMoving=!0)))},Panel.prototype.close=function(){var e=this;switch(BuglessPanels.activePanel=null,e.animateOn(),this.position){case Panel.POSITION_LEFT:this.moveX(0);break;case Panel.POSITION_RIGHT:this.moveX(100);break;case Panel.POSITION_TOP:this.moveY(0);break;case Panel.POSITION_BOTTOM:this.moveY(100)}setTimeout(function(){BuglessPanels.backdropOff(),e.hide(),Help.triggerEvent(e.element,"closed",{panel:e}),e.isOpened=!1,e.isMoving=!1,e.shown=!1},BuglessPanels.getAnimationTime(".animate"))},Panel.prototype.open=function(){var e=this;BuglessPanels.activePanel=e,e.show();var t=setInterval(function(){if("block"==e.element.style.display){switch(clearInterval(t),e.animateOn(),e.position){case Panel.POSITION_LEFT:e.moveX(100);break;case Panel.POSITION_RIGHT:e.moveX(0);break;case Panel.POSITION_TOP:e.moveY(100);break;case Panel.POSITION_BOTTOM:e.moveY(0)}setTimeout(function(){e.isOpened||Help.triggerEvent(e.element,"opened",{panel:e}),e.isOpened=!0,e.isMoving=!1,e.shown=!1},BuglessPanels.getAnimationTime(".animate"))}},50)},Panel.prototype.on=function(e,t){Help.addListener(this.element,e,t,!1)},Panel.prototype.off=function(e){Help.removeListener(this.element,e)};var Help={_eventHandlers:{},screenWidth:function(){return document.documentElement.clientWidth},screenHeight:function(){return document.documentElement.clientHeight},calculatePercentageX:function(e){return 100*e/window.innerWidth},calculatePercentageY:function(e){return 100*e/window.innerHeight},hasClass:function(e,t){return e.classList?e.classList.contains(t):!!e.className.match(new RegExp("(\\s|^)"+t+"(\\s|$)"))},addClass:function(e,t){e.classList?e.classList.add(t):hasClass(e,t)||(e.className+=" "+t)},removeClass:function(e,t){if(e.classList)e.classList.remove(t);else if(hasClass(e,t)){var n=new RegExp("(\\s|^)"+t+"(\\s|$)");e.className=e.className.replace(n," ")}},addListener:function(e,t,n,i){e in this._eventHandlers||(this._eventHandlers[e]={}),t in this._eventHandlers[e]||(this._eventHandlers[e][t]=[]),this._eventHandlers[e][t].push([n,i]),e.addEventListener(t,n,i)},removeListener:function(e,t){if(e in this._eventHandlers&&t in this._eventHandlers[e])for(var n=this._eventHandlers[e][t],i=0,l=n.length;l>i;i++){var a=n[i];e.removeEventListener(t,a[0],a[1])}},triggerEvent:function(e,t,n){var i=document.createEvent("Event");i.initEvent(t,!0,!0);for(var l in n)i[l]=n[l];e.dispatchEvent(i)},closest:function(e,t){var n,i;for(["matches","webkitMatchesSelector","mozMatchesSelector","msMatchesSelector","oMatchesSelector"].some(function(e){return"function"==typeof document.body[e]?(n=e,!0):!1});null!==e;){if(i=e.parentElement,null!==i&&i[n](t))return i;e=i}return null}};
//# sourceMappingURL=bugless-panel.min.js.map
